"use strict";(self.webpackChunkanvil_code_walkthrough=self.webpackChunkanvil_code_walkthrough||[]).push([[1006],{450:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>a,contentTitle:()=>c,default:()=>u,frontMatter:()=>l,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"anvil/tasks/block-listener","title":"\u533a\u5757\u76d1\u542c\uff08tasks/block_listener.rs\uff09","description":"\u6982\u8ff0\uff1a\u76d1\u542c\u65b0\u5757\uff08\u672c\u5730\u6216\u4e0a\u6e38\uff09\uff0c\u89e6\u53d1\u65e5\u5fd7\u5339\u914d\u3001\u4e8b\u4ef6\u5e7f\u64ad\u4e0e\u8fc7\u6ee4\u5668\u589e\u91cf\u8ba1\u7b97\u7b49\u540e\u7eed\u6d41\u7a0b\u3002","source":"@site/docs/anvil/tasks/block-listener.md","sourceDirName":"anvil/tasks","slug":"/anvil/tasks/block-listener","permalink":"/anvil-code-walkthrough/docs/anvil/tasks/block-listener","draft":false,"unlisted":false,"editUrl":"https://github.com/Thneoly/anvil-code-walkthrough/edit/main/docs/anvil/tasks/block-listener.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"id":"block-listener","title":"\u533a\u5757\u76d1\u542c\uff08tasks/block_listener.rs\uff09","sidebar_label":"\u533a\u5757\u76d1\u542c","sidebar_position":1,"base_commit":"575bf62c","upstream_repo":"foundry-rs/foundry","upstream_path":"crates/anvil/src/tasks/block_listener.rs"},"sidebar":"tutorialSidebar","previous":{"title":"\u540e\u53f0\u4efb\u52a1","permalink":"/anvil-code-walkthrough/docs/category/\u540e\u53f0\u4efb\u52a1"},"next":{"title":"\u53ef\u89c2\u6d4b\u6027","permalink":"/anvil-code-walkthrough/docs/category/\u53ef\u89c2\u6d4b\u6027"}}');var t=n(4848),i=n(8453);const l={id:"block-listener",title:"\u533a\u5757\u76d1\u542c\uff08tasks/block_listener.rs\uff09",sidebar_label:"\u533a\u5757\u76d1\u542c",sidebar_position:1,base_commit:"575bf62c",upstream_repo:"foundry-rs/foundry",upstream_path:"crates/anvil/src/tasks/block_listener.rs"},c=void 0,a={},o=[];function d(e){const s={code:"code",li:"li",mermaid:"mermaid",p:"p",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.p,{children:"\u6982\u8ff0\uff1a\u76d1\u542c\u65b0\u5757\uff08\u672c\u5730\u6216\u4e0a\u6e38\uff09\uff0c\u89e6\u53d1\u65e5\u5fd7\u5339\u914d\u3001\u4e8b\u4ef6\u5e7f\u64ad\u4e0e\u8fc7\u6ee4\u5668\u589e\u91cf\u8ba1\u7b97\u7b49\u540e\u7eed\u6d41\u7a0b\u3002"}),"\n",(0,t.jsx)(s.p,{children:"\u5feb\u901f\u94fe\u63a5\uff1a"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"\u6e90\u7801\uff08block_listener.rs\uff09\uff1aref/foundry-575bf62c/crates/anvil/src/tasks/block_listener.rs"}),"\n",(0,t.jsx)(s.li,{children:"\u6e90\u7801\uff08tasks/mod.rs\uff09\uff1aref/foundry-575bf62c/crates/anvil/src/tasks/mod.rs"}),"\n",(0,t.jsx)(s.li,{children:"\u6e90\u7801\uff08pubsub.rs\uff09\uff1aref/foundry-575bf62c/crates/anvil/src/pubsub.rs"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"\u65f6\u5e8f\uff08\u7b80\u5316\uff09\uff1a"}),"\n",(0,t.jsx)(s.mermaid,{value:'sequenceDiagram\n  participant M as "miner/chain"\n  participant L as "block_listener"\n  participant F as "filter"\n  participant PS as "pubsub"\n  M--\x3e>L: \u65b0\u533a\u5757\u5934/\u4f53\n  L->>F: \u5339\u914d\u65e5\u5fd7/\u5730\u5740/\u4e3b\u9898\n  F--\x3e>L: \u5339\u914d\u7ed3\u679c\n  L->>PS: \u5e7f\u64ad newHeads/logs/pendingTx \u7b49\n  PS--\x3e>Subscribers: \u63a8\u9001\u6d88\u606f'}),"\n",(0,t.jsx)(s.p,{children:"\u5173\u952e\u70b9\uff1a"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["\u8ba2\u9605\u7c7b\u578b\uff1a",(0,t.jsx)(s.code,{children:"newHeads"}),"\u3001",(0,t.jsx)(s.code,{children:"logs"}),"\u3001",(0,t.jsx)(s.code,{children:"newPendingTransactions"})," \u7b49\uff1b\u4e0e ",(0,t.jsx)(s.code,{children:"eth_newFilter"}),"/",(0,t.jsx)(s.code,{children:"eth_getFilterChanges"})," \u534f\u540c\u3002"]}),"\n",(0,t.jsx)(s.li,{children:"\u56de\u586b\u4e0e\u91cd\u653e\uff1a\u5f53\u91cd\u7ec4\u6216\u56de\u6eda\u53d1\u751f\u65f6\uff0c\u9700\u8981\u64a4\u56de\u4e0e\u91cd\u653e\u4e8b\u4ef6\uff1b\u4fdd\u6301\u8ba2\u9605\u7aef\u4e00\u81f4\u6027\u3002"}),"\n",(0,t.jsx)(s.li,{children:"\u80cc\u538b\u4e0e\u9650\u6d41\uff1a\u9ad8\u9891\u51fa\u5757/\u5927\u91cf\u65e5\u5fd7\u65f6\u5bf9\u5355\u94fe\u63a5\u65bd\u52a0\u901f\u7387\u9650\u5236\uff0c\u907f\u514d WS \u5835\u585e\u3002"}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"\u6d4b\u8bd5\u5efa\u8bae\uff1a"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsxs)(s.li,{children:["\u6784\u9020\u5339\u914d/\u4e0d\u5339\u914d\u7684\u65e5\u5fd7\uff0c\u65ad\u8a00 ",(0,t.jsx)(s.code,{children:"getFilterChanges"})," \u4e0e ",(0,t.jsx)(s.code,{children:"eth_subscribe logs"})," \u8fd4\u56de\u4e00\u81f4\u3002"]}),"\n",(0,t.jsx)(s.li,{children:"\u6a21\u62df\u77ed\u91cd\u7ec4\uff08reorg 1-2 \u4e2a\u5757\uff09\uff0c\u9a8c\u8bc1\u64a4\u56de/\u91cd\u653e\u987a\u5e8f\u4e0e\u53bb\u91cd\u7b56\u7565\u3002"}),"\n"]})]})}function u(e={}){const{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,t.jsx)(s,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,s,n)=>{n.d(s,{R:()=>l,x:()=>c});var r=n(6540);const t={},i=r.createContext(t);function l(e){const s=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function c(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),r.createElement(i.Provider,{value:s},e.children)}}}]);