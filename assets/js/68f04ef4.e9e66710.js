"use strict";(self.webpackChunkanvil_code_walkthrough=self.webpackChunkanvil_code_walkthrough||[]).push([[1472],{2794:(n,e,o)=>{o.r(e),o.d(e,{assets:()=>d,contentTitle:()=>l,default:()=>u,frontMatter:()=>s,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"anvil/txpool/pending-and-promotion","title":"Pending \u4e0e Queued \u4ee5\u53ca\u63d0\u5347\u673a\u5236","description":"\u4ea4\u6613\u6c60\u5c06\u540c\u4e00\u8d26\u6237\u7684\u4ea4\u6613\u7ec4\u7ec7\u4e3a\u201c\u53ef\u6267\u884c\u7684\u8fde\u7eed\u94fe\uff08Pending\uff09\u201d\u4e0e\u201c\u5b58\u5728\u7f3a\u53e3\u7684\u5019\u9009\uff08Queued\uff09\u201d\u3002\u5f53\u7f3a\u53e3\u88ab\u8865\u9f50\u65f6\uff0c\u540e\u7eed\u4ea4\u6613\u4f1a\u88ab\u63d0\u5347\u81f3 Pending \u5e76\u8fdb\u5165\u77ff\u5de5\u7684\u5019\u9009\u96c6\u5408\u3002","source":"@site/docs/anvil/txpool/pending-and-promotion.md","sourceDirName":"anvil/txpool","slug":"/anvil/txpool/pending-and-promotion","permalink":"/anvil-code-walkthrough/docs/anvil/txpool/pending-and-promotion","draft":false,"unlisted":false,"editUrl":"https://github.com/Thneoly/anvil-code-walkthrough/edit/main/docs/anvil/txpool/pending-and-promotion.md","tags":[],"version":"current","sidebarPosition":2.5,"frontMatter":{"title":"Pending \u4e0e Queued \u4ee5\u53ca\u63d0\u5347\u673a\u5236","sidebar_position":2.5,"base_commit":"575bf62c","upstream_repo":"foundry-rs/foundry","upstream_path":"crates/anvil/src/eth/pool/transactions.rs"},"sidebar":"tutorialSidebar","previous":{"title":"\u5165\u6c60\u7ba1\u7ebf\u4e0e\u6821\u9a8c\uff08admission pipeline\uff09","permalink":"/anvil-code-walkthrough/docs/anvil/txpool/pipeline"},"next":{"title":"\u5bb9\u91cf\u9650\u5236\u4e0e\u9010\u51fa\u7b56\u7565\uff08limits & eviction\uff09","permalink":"/anvil-code-walkthrough/docs/anvil/txpool/limits-and-eviction"}}');var t=o(4848),r=o(8453);const s={title:"Pending \u4e0e Queued \u4ee5\u53ca\u63d0\u5347\u673a\u5236",sidebar_position:2.5,base_commit:"575bf62c",upstream_repo:"foundry-rs/foundry",upstream_path:"crates/anvil/src/eth/pool/transactions.rs"},l=void 0,d={},a=[{value:"\u8d26\u6237\u89c6\u56fe\uff08\u793a\u610f\uff09",id:"\u8d26\u6237\u89c6\u56fe\u793a\u610f",level:2},{value:"\u63d0\u5347\uff08Promotion\uff09",id:"\u63d0\u5347promotion",level:2},{value:"\u8fb9\u754c\u4e0e\u4e00\u81f4\u6027",id:"\u8fb9\u754c\u4e0e\u4e00\u81f4\u6027",level:2},{value:"\u5efa\u8bae\u6d4b\u8bd5",id:"\u5efa\u8bae\u6d4b\u8bd5",level:2}];function c(n){const e={a:"a",code:"code",h2:"h2",li:"li",mermaid:"mermaid",p:"p",ul:"ul",...(0,r.R)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.p,{children:"\u4ea4\u6613\u6c60\u5c06\u540c\u4e00\u8d26\u6237\u7684\u4ea4\u6613\u7ec4\u7ec7\u4e3a\u201c\u53ef\u6267\u884c\u7684\u8fde\u7eed\u94fe\uff08Pending\uff09\u201d\u4e0e\u201c\u5b58\u5728\u7f3a\u53e3\u7684\u5019\u9009\uff08Queued\uff09\u201d\u3002\u5f53\u7f3a\u53e3\u88ab\u8865\u9f50\u65f6\uff0c\u540e\u7eed\u4ea4\u6613\u4f1a\u88ab\u63d0\u5347\u81f3 Pending \u5e76\u8fdb\u5165\u77ff\u5de5\u7684\u5019\u9009\u96c6\u5408\u3002"}),"\n",(0,t.jsx)(e.p,{children:"\u5feb\u901f\u94fe\u63a5\uff1a"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsxs)(e.li,{children:["\u6e90\u7801\uff08pool/transactions.rs\uff09\uff1a",(0,t.jsx)(e.a,{href:"https://github.com/foundry-rs/foundry/blob/575bf62c/crates/anvil/src/eth/pool/transactions.rs",children:"https://github.com/foundry-rs/foundry/blob/575bf62c/crates/anvil/src/eth/pool/transactions.rs"})]}),"\n",(0,t.jsxs)(e.li,{children:["\u6e90\u7801\uff08pool/mod.rs\uff09\uff1a",(0,t.jsx)(e.a,{href:"https://github.com/foundry-rs/foundry/blob/575bf62c/crates/anvil/src/eth/pool/mod.rs",children:"https://github.com/foundry-rs/foundry/blob/575bf62c/crates/anvil/src/eth/pool/mod.rs"})]}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"\u8d26\u6237\u89c6\u56fe\u793a\u610f",children:"\u8d26\u6237\u89c6\u56fe\uff08\u793a\u610f\uff09"}),"\n",(0,t.jsx)(e.mermaid,{value:"classDiagram\n    class AccountView {\n        +address: Address\n        +baseNonce: u64\n        +pending: Map<nonce, Tx>\n        +queued: Map<nonce, Tx>\n        +head(): u64 // \u4e0b\u4e00\u53ef\u6267\u884c nonce\n    }"}),"\n",(0,t.jsx)(e.h2,{id:"\u63d0\u5347promotion",children:"\u63d0\u5347\uff08Promotion\uff09"}),"\n",(0,t.jsx)(e.mermaid,{value:"sequenceDiagram\n    participant P as Pool\n    participant A as AccountView\n    participant M as Miner\n    P->>A: \u63d2\u5165 nonce = N \u7684\u4ea4\u6613\n    A--\x3e>P: \u653e\u5165 queued\uff08\u82e5 N > head\uff09\n    Note over A: \u5f53 head \u7684\u4ea4\u6613\u88ab\u8865\u9f50\n    A--\x3e>P: \u5c06\u8fde\u7eed\u533a\u95f4 [head..K] \u4ece queued \u2192 pending\n    P->>M: \u5e7f\u64ad\u201c\u53ef\u6253\u5305\u4ea4\u6613\u66f4\u65b0\u201d"}),"\n",(0,t.jsx)(e.p,{children:"\u89c4\u5219\uff1a"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"head \u7531\u94fe\u4e0a nonce \u4e0e\u6c60\u5185 pending \u5171\u540c\u51b3\u5b9a\u3002"}),"\n",(0,t.jsxs)(e.li,{children:["\u53ea\u8981 ",(0,t.jsx)(e.code,{children:"head"})," \u7684\u4ea4\u6613\u5b58\u5728\u5e76\u6210\u529f\u8fdb\u5165 pending\uff0c\u968f\u540e\u7684\u8fde\u7eed nonce \u4ea4\u6613\u5c06\u88ab\u6574\u4f53\u63d0\u5347\u3002"]}),"\n",(0,t.jsx)(e.li,{children:"\u82e5\u4e0a\u94fe\u540e\u8d26\u6237 nonce \u524d\u8fdb\uff0cpending \u4e2d\u5c0f\u4e8e\u65b0 nonce \u7684\u4ea4\u6613\u4f1a\u88ab\u79fb\u9664\uff1b\u968f\u540e\u518d\u89e6\u53d1\u4e00\u6b21\u63d0\u5347\u68c0\u67e5\u3002"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"\u8fb9\u754c\u4e0e\u4e00\u81f4\u6027",children:"\u8fb9\u754c\u4e0e\u4e00\u81f4\u6027"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u540c\u8d26\u6237\u540c nonce \u53ea\u4fdd\u7559\u4e00\u4e2a\u201c\u6709\u6548\u7248\u672c\u201d\uff0c\u66ff\u6362\u6210\u529f\u540e\u9700\u66f4\u65b0\u4e24\u4fa7\u89c6\u56fe\u3002"}),"\n",(0,t.jsx)(e.li,{children:"\u63d0\u5347\u4e0d\u5e94\u6253\u7834 pending \u7684\u8fde\u7eed\u6027\uff1b\u82e5\u53d1\u73b0\u7f3a\u53e3\u9700\u56de\u9000\u81f3 queued \u7b49\u5f85\u8865\u9f50\u3002"}),"\n",(0,t.jsx)(e.li,{children:"Reorg \u4e0e\u4f59\u989d\u53d8\u5316\u53ef\u80fd\u5bfc\u81f4\u201c\u539f\u672c\u53ef\u6267\u884c\u201d\u7684\u4ea4\u6613\u6682\u4e0d\u53ef\u6267\u884c\uff0c\u77ff\u5de5\u6253\u5305\u9636\u6bb5\u9700\u518d\u6b21\u6821\u9a8c\u8d39\u7528\u4e0e\u4e0a\u9650\u3002"}),"\n"]}),"\n",(0,t.jsx)(e.h2,{id:"\u5efa\u8bae\u6d4b\u8bd5",children:"\u5efa\u8bae\u6d4b\u8bd5"}),"\n",(0,t.jsxs)(e.ul,{children:["\n",(0,t.jsx)(e.li,{children:"\u53d1\u9001 nonce \u95f4\u9694\u4e3a 0\u30012\u30011\u30013 \u7684\u5e8f\u5217\uff0c\u89c2\u5bdf 1 \u5230\u8fbe\u540e 2 \u88ab\u63d0\u5347\u7684\u8fc7\u7a0b\u3002"}),"\n",(0,t.jsx)(e.li,{children:"\u89e6\u53d1\u533a\u5757\u63d0\u4ea4\u4e0e\u56de\u6eda\uff0c\u9a8c\u8bc1 pending/queued \u7684\u72b6\u6001\u8f6c\u6362\u4e0e\u4e8b\u4ef6\u3002"}),"\n"]})]})}function u(n={}){const{wrapper:e}={...(0,r.R)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(c,{...n})}):c(n)}},8453:(n,e,o)=>{o.d(e,{R:()=>s,x:()=>l});var i=o(6540);const t={},r=i.createContext(t);function s(n){const e=i.useContext(r);return i.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function l(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(t):n.components||t:s(n.components),i.createElement(r.Provider,{value:e},n.children)}}}]);